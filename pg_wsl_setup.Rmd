---
title: "pg_wsl"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 

`wsl` installed.  `postgres` installed into `wsl` .  Manged now to get bcdata bc2pg bc-airports --db_url postgresql://postgres:postgres@localhost:5432/postgis to run in my command line but not without the db_url option and still cannot for the life of me figure out how to get `bcdata` to burn anything to the db in wsl. Failed. Another 24.25hours invested.  Insane.  Here is a bit of a file tracking what I have been trying.



I have so far set up wsl and have installed a postgresql 13 using https://computingforgeeks.com/how-to-install-postgresql-13-on-ubuntu/.

<br>


Only real mod to this was that I needed to assign a password `sudo passwd postgres` as per https://karansingh1559.medium.com/how-to-set-up-postgresql-on-ubuntu-for-wsl-fcbb777d165b 

<br>

I changed the port to 5434 as I already have postgres on 5432 in my normal windows OS so I will leave there. I changed it as per 
https://karansingh1559.medium.com/how-to-set-up-postgresql-on-ubuntu-for-wsl-fcbb777d165b with `sudo vi /etc/postgresql/13/main/postgresql.conf`.

`sudo /etc/init.d/postgresql stop`
`sudo /etc/init.d/postgresql start`

<br>

Bit of info here on changing unix socket https://www.jamescoyle.net/how-to/3019-how-to-change-the-listening-port-for-postgresql-database#:~:text=The%20default%20TCP%20port%20for,file%20for%20the%20database%20server.

<br>

`sudo vi /etc/postgresql/13/main/postgresql.conf`
listen_addresses = '*'                  # what IP address(es) to listen on;  



<br>

To insert in Vim press I. To get out press `:` then tyupe `q!` 
to save and leave `:wq!`
https://help.dreamhost.com/hc/en-us/articles/115006413028-Creating-and-editing-a-file-via-SSH#:~:text=Using%20'vim'%20to%20create%20and%20edit%20a%20file,-Log%20into%20your&text=Navigate%20to%20the%20directory%20location%20you%20wish%20to%20create%20the,or%20edit%20an%20existing%20file.&text=Press%20the%20letter%20i%20on,enter%20INSERT%20mode%20in%20vim.&text=Start%20typing%20into%20the%20file,file%2C%20press%20the%20ESC%20key.


<br>

I didn't add postgis at install so will try to add it now with https://computingforgeeks.com/how-to-install-postgis-on-ubuntu-debian/

`psql -d postgis_test`
`CREATE EXTENSION postgis;`
`create extension ltree;`


verify:

`SELECT PostGIS_version();`

success

`sudo -i -u postgres`

Seems to be working.  


This has useful info on seeing where your wsl ip is at
https://serverfault.com/questions/1041981/how-can-i-connect-to-postgres-running-on-the-windows-host-from-inside-wsl2
`ifconfig`
`cat /etc/resolv.conf`

Lets try to run bcdata and set up env variables

`(base) newgraph@MSI:~$ bcdata list | grep AIRPORTS
WHSE_IMAGERY_AND_BASE_MAPS.GSR_AIRPORTS_SVW`

works

`bcdata bc2pg bc-airports --db_url postgresql://newgraph:postgres@localhost:5434/postgis`

## from simon
I think the key here is creating the new db user. Don't use the default postgres user. I think postgres prompts you for a pwd when you do createuser -P -s -e mynewuser.


what a BOSS!


problem with permissions https://www.tenforums.com/tutorials/127857-access-wsl-linux-files-windows-10-a.html 

files are at `\\wsl$\Ubuntu-18.04`
 
 to fix permissions to give permissions to a folder and every file and folder inside it. Omit the x from either command if you donâ€™t want the files to be executable.

 https://superuser.com/questions/1352207/windows-wsl-ubuntu-sees-wrong-permissions-on-files-in-mounted-disk
`sudo chmod -R a+rwx /etc/postgresql/13/main/pg_hba.conf`
`sudo chmod -R a+rwx /etc`
       
       

List of commands

`\du` list db users and roles
`\l` see databases and privileges




